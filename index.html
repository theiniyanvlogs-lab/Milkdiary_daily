<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Milk Diary</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ===== Firebase SDK ===== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCHQqBRiM6RRAE7CCfbp2spxXUt65QxGPs",
  authDomain: "milkdiarylock.firebaseapp.com",
  databaseURL: "https://milkdiarylock-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "milkdiarylock",
  storageBucket: "milkdiarylock.firebasestorage.app",
  messagingSenderId: "602886268250",
  appId: "1:602886268250:web:b8010e9df56b3164c9bf63"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== Unlock Function =====
window.unlockApp = function() {
  const enteredPwd = document.getElementById("unlockPwd").value;
  const dbRef = ref(db, "lockPassword");

  get(dbRef).then((snapshot)=>{
    if(snapshot.exists()){
      const realPwd = snapshot.val();
      if(enteredPwd === realPwd){
        document.getElementById("lockScreen").style.display="none";
        document.getElementById("mainApp").style.display="block";
      } else {
        alert("‚ùå Wrong Password");
      }
    } else {
      alert("Password not found in server");
    }
  });
}
</script>

<!-- ===== Styles ===== -->
<style>
body{font-family:Arial;margin:0;background:#f2f2f2}
.center{display:flex;align-items:center;justify-content:center;height:100vh}
.box{background:#fff;padding:25px;border-radius:10px;max-width:420px;width:100%;text-align:center;box-shadow:0 0 10px #ccc}
input{width:100%;padding:10px;font-size:16px;margin-top:10px}
button{border:none;padding:12px;border-radius:6px;font-size:16px;cursor:pointer;margin-top:10px}
.blue{background:#2196f3;color:#fff;width:100%}
.green{background:#4caf50;color:#fff;width:100%}
.gray{background:#999;color:#fff;width:100%}
.billBox{background:#fff;padding:20px;border-radius:10px;max-width:500px;margin:auto;box-shadow:0 0 10px #ccc}
pre{white-space:pre-wrap;font-size:15px;text-align:left}
header{background:#1976d2;color:#fff;padding:15px;text-align:center;font-size:20px;font-weight:bold}
</style>

</head>
<body>

<!-- ===== LOCK SCREEN ===== -->
<div id="lockScreen" class="center">
  <div class="box">
    <h3>üîí Milk Diary Locked</h3>
    <input id="unlockPwd" type="password" placeholder="Enter Password">
    <button class="blue" onclick="unlockApp()">Unlock</button>
  </div>
</div>

<!-- ===== MAIN APP AFTER UNLOCK ===== -->
<div id="mainApp" style="display:none">

<header>MILK DIARY - BILL</header>

<br>

<div class="billBox" id="billContent">
<pre>
MILK DIARY BILL

Plot / Door No:
G202

Address:
Tudor

Period:
01/01/2026  to  31/01/2026

--------------------------------

Daily Milk:
2 pkt √ó 31 days = 62 pkt

Extra Milk:
Nil
Total Extra: 0 pkt

Not Supplied:
04/01/2026 : 2 pkt

Total Not Supplied: 2 pkt

--------------------------------

Final Milk:
62 + 0 - 2 = 60 pkt

Milk Rate:
‚Çπ23 per pkt

Milk Amount:
60 √ó ‚Çπ23 = ‚Çπ1380

Service Charge:
‚Çπ100

--------------------------------

GRAND TOTAL:
‚Çπ1480

--------------------------------
Powered by Milk Diary - iniyan.talkies
</pre>

<button class="green" onclick="sendWhatsApp()">üì≤ Send to Milkman WhatsApp</button>
<button class="blue" onclick="savePDF()">üíæ Save PDF</button>
<button class="gray" onclick="location.reload()">‚¨Ö Back</button>

</div>
</div>

<!-- ===== WhatsApp Function ===== -->
<script>
function sendWhatsApp(){
  let text = document.querySelector("#billContent pre").innerText;
  window.open("https://wa.me/?text=" + encodeURIComponent(text));
}
</script>

<!-- ===== PDF Save ===== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
function savePDF(){
  const element = document.getElementById("billContent");
  html2pdf().from(element).save("MilkDiaryBill.pdf");
}
</script>

</body>
</html>
